---
layout: post
title: ç¼–ç è§„èŒƒå·¥ç¨‹åŒ– â€”â€” Commitlint
date: 2025-09-17
tags: å·¥ç¨‹åŒ–
previous:
  title: ç‹‚ç¥ â€”â€” Docker å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰
  url: /blogs/2025/08-27-2.md
next:
  title: WeakMap ä½¿ç”¨æŒ‡å—ï¼ˆå®ç°ç§æœ‰å±æ€§ï¼‰
  url: /blogs/2025/09-19.md
---

ä¸ºäº†æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ commitlint åŠå…¶ç›¸å…³ç”Ÿæ€ï¼Œä»Šå¤©ç‰¹æ„èŠ±äº†ä¸€ä¸Šåˆæ—¶é—´è¯» commitlint çš„æºç ï¼Œè¿™é‡Œåšä¸€ä¸ªå­¦ä¹ è®°å½•ï¼Œæ–¹ä¾¿åç»­å›é¡¾ã€‚

å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š

[commitlint](https://commitlint.js.org/)

## å¼€å§‹

### å®‰è£…

    `pnpm add -D @commitlint/cli @commitlint/config-conventional`

### é…ç½®

é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º commitlint.config.js æ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š

```js
export default {
  extends: ["@commitlint/config-convertional"],
};
```

## ä½¿ç”¨

### æ·»åŠ é’©å­

ä½¿ç”¨ commitlint éœ€è¦è®¾ç½® commit-msg é’©å­ï¼ˆç›®å‰ä¸æ”¯æŒ pre-commit é’©å­ï¼‰

#### 1. ä½¿ç”¨ Git é’©å­ç®¡ç†å™¨

å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ husky æä¾›çš„ commit-msg é’©å­

> husky: Git é’©å­ç®¡ç†å™¨
>
> commitizen: æä¾›äº¤äº’å¼ç•Œé¢ï¼Œä½¿ç”¨æˆ·å¯ä»¥é€‰æ‹© commit çš„å†…å®¹
>
> cz-gitï¼šcommitizen çš„å¢å¼ºç‰ˆé€‚é…å™¨ï¼Œä¸º commitzen æä¾›æ›´å¼ºå¤§ã€æ›´ç¬¦åˆä¸­æ–‡å¼€å‘è€…ä¹ æƒ¯çš„æé—®æµç¨‹
>
> lint-staged: åª lint æ›´æ”¹çš„æ–‡ä»¶

##### ï¼ˆ1ï¼‰å®‰è£… husky

    `npm install -D husky`

##### ï¼ˆ2ï¼‰ç”Ÿæˆè„šæœ¬æ–‡ä»¶

```bash
 # åœ¨.husky/ ç›®å½•ä¸‹åˆ›å»º pre-commit è„šæœ¬æ–‡ä»¶
 npx husky init
 # åœ¨ .husky/ ç›®å½•ä¸‹åˆ›å»º commit-msg è„šæœ¬æ–‡ä»¶
 echo npx --no commitlint --edit $1 > .husky/commit-msg
```

##### ç¤ºä¾‹

```bash
#/usr/bin/env sh
npx --no commitlint --edit $1
# --no åªè¿è¡Œæœ¬åœ°å·²å®‰è£…çš„å‘½ä»¤ï¼Œç¦æ­¢ npx è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„åŒ…
# --editï¼šread last commit message from the specified file or fallbacks to ./.git/COMMIT_EDITMSG
# $1 Gitä¼ å…¥çš„æäº¤ä¿¡æ¯
```

> `#!` (Shebang) é€šå¸¸å‡ºç°åœ¨ç±» Unix ç³»ç»Ÿçš„è„šæœ¬ä¸­ç¬¬ä¸€è¡Œï¼Œä½œä¸ºå‰ä¸¤ä¸ªå­—ç¬¦ã€‚
>
> åœ¨ Shebang ä¹‹åï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç©ºç™½å­—ç¬¦ï¼Œåæ¥è§£é‡Šå™¨çš„ç»å¯¹è·¯å¾„ï¼Œç”¨äºæŒ‡æ˜æ‰§è¡Œè¿™ä¸ªè„šæœ¬æ–‡ä»¶çš„è§£é‡Šå™¨ã€‚
>
> ä¾‹å¦‚ï¼Œä»¥æ‰§è¡Œ `#!/bin/sh` å¼€å¤´çš„æ–‡ä»¶ï¼Œåœ¨æ‰§è¡Œæ—¶ä¼šå®é™…è°ƒç”¨ `/bin/sh` ç¨‹åºï¼Œé€šå¸¸æ˜¯ Bourne shell æˆ–å…¼å®¹çš„ shellï¼Œä¾‹å¦‚ bashã€dash ç­‰ã€‚
>
> ä½¿ç”¨ `#!/usr/bin/env` æ˜¯ä¸€ç§å¸¸è§çš„åœ¨ä¸åŒå¹³å°ä¸Šéƒ½èƒ½æ­£ç¡®æ‰¾åˆ°è§£é‡Šå™¨çš„åŠæ³•ã€‚å› ä¸º env ä¸€èˆ¬å›ºå®šåœ¨ /usr/bin ç›®å½•ä¸‹ï¼Œè€Œå…¶ä½™è§£é‡Šå™¨çš„å®‰è£…ä½ç½®å°±ç›¸å¯¹ä¸é‚£ä¹ˆå›ºå®šã€‚

##### ï¼ˆ3ï¼‰æäº¤

```bash
git commit -m "commit_msg"
```

æ­¤æ—¶ï¼Œä¼šè§¦å‘ husky æ‰§è¡Œè„šæœ¬æ–‡ä»¶ã€‚

#### 2. git hooks

##### å®¢æˆ·ç«¯é’©å­

###### (1) Committing-Workflow Hooksï¼ˆç”± `git commit` å‘½ä»¤è§¦å‘ï¼‰

- pre-commit ç”¨äºæ£€æŸ¥ä»£ç ï¼ˆlintï¼‰
- prepare-commit-msg
- commit-msg
- post-commit

(2) Emial Workflow Hooksï¼ˆç”± `git am` å‘½ä»¤è§¦å‘ï¼‰

- applypatch-msg
- pre-applypatch
- post-applypatch

(3) Other Client Hooks

- pre-rebase
- post-rewrite
- post-checkout
- post-merge
- pre-push
- pre-auto-gc

##### æœåŠ¡ç«¯é’©å­

- pre-receive
- update
- post-receive

### æµ‹è¯•

æ£€æŸ¥æœ€åä¸€æ¬¡æäº¤ï¼š

```bash
npx commitlint --from HEAD~1 --to HEAD --verbose
```

`--verbose`ï¼šæ²¡æœ‰ä»»ä½•é”™è¯¯æ—¶ä¼šè¿”å›ï¼šâ€œNo staged files match any of provided globs.â€ã€‚é»˜è®¤æƒ…å†µä¸‹å¦‚æœ commitlint æˆåŠŸåˆ™ä¸è¿”å›ä»»ä½•å†…å®¹æç¤ºã€‚

## CI è®¾ç½®

### GitHub Actions

```yaml
name: CI
on: [push, pull_request]

jobs:
	commitlint:
		runs-on: ubuntu-22.04
		steps:
			- uses: actions/checkout@v3
				with:
					fetch-depth: 0 # è¡¨ç¤ºä¼šæ£€æŸ¥æ‰€æœ‰å†å²æäº¤
			- name: Install required dependencies
				run: |
					apt update # åˆ·æ–°è½¯ä»¶åŒ…ç´¢å¼•åˆ—è¡¨
					apt install -y sudo # å®‰è£… sudo å‘½ä»¤
					sudo apt install -y git curl # å®‰è£… gitï¼Œcurl
					curl -sL https://deb.nodesource.com/s/etup_14.x | sudo -E bash - # æ·»åŠ  NodeSource çš„ Node.js 14.x è½¯ä»¶æºåˆ°ç³»ç»Ÿ
					sudo DEBIAN_FRONTEND=nointeractive apt install -y nodejs # å®‰è£… node.js
			- name: Print versions
				run: |
					git --version
					node --version
					npm --version
					npx commitlint --version
			- name: Install commitlint
				run: |
					npm install conventional-changelog-conventionalcommits
					npm install commitlint@latest
			- name: Validate current commit (last commit) with commitlint
				if: github.event_name == 'push'
				run: npx commitlint --last --verbose
			- name: Validate PR commits with commitlint
				if: github.event_name == 'pull_request'
				run: npx commitlint --from ${{ github.event.pull_request.base.sha }} --to ${{ github.event.pull_request.head.sha }} --verbose
```

## äº¤äº’å¼æç¤º

ä»¥ä¸‹åŒ…æœ‰åŠ©äºå¿«é€Ÿç¼–å†™æäº¤æ¶ˆæ¯ï¼Œå¹¶ç¡®ä¿å…¶éµå¾ª `commitlint.config.js` ä¸­é…ç½®çš„æäº¤çº¦å®šã€‚

### 1. `@commitlint/prompt-cli`

ï¼ˆ1ï¼‰å®‰è£…

    `npm install -D @commitlint-prompt-cli`

ï¼ˆ2ï¼‰åœ¨ package.json ä¸­æ·»åŠ è„šæœ¬

```json
{
  "scripts": {
    "commit": "commit"
  }
}
```

ï¼ˆ3ï¼‰è¿è¡Œ

```json
npm run commit
```

### 2. `commitizen` + `cz-git` (é€‚é…å™¨)

æ’ä»¶åŒ–æ€æƒ³ï¼šä½ å¯ä»¥ç†è§£ä¸º commitizen æä¾›äº†ä¸€ä¸ªåŸºåº§ï¼Œè¿™ä¸ªåŸºåº§å¯ä»¥æ‰©å±•å…¶ä»–æ’ä»¶ï¼ˆé€‚é…å™¨ï¼‰æ¥å¢å¼ºåŠŸèƒ½ã€‚ä¾‹å¦‚ Vue å’Œ Vue Routerï¼ŒBabel ç”Ÿæ€ç­‰ã€‚

ï¼ˆ1ï¼‰å®‰è£…

```bash
npm install -D commitizen cz-git
```

ï¼ˆ2ï¼‰åœ¨ package.json ä¸­é…ç½® `config` æŒ‡å®šä½¿ç”¨çš„é€‚é…å™¨ï¼Œæ·»åŠ è„šæœ¬ï¼š

```json
{
  "scripts": {
    "commit": "git-cz"
  },
  "config": {
    "commitizen": {
      "path": "node_modules/cz-git"
    }
  }
}
```

ï¼ˆ3ï¼‰åœ¨ `commitlint.config.js` ä¸­é…ç½®äº¤äº’å¼å‘½ä»¤æç¤ºæ¨¡æ¿ï¼š

```jsx
export default {
  prompt: {
    messages: {},
    questions: {
      type: {},
    },
  },
};
```

å¦‚æœä½¿ç”¨ commitizen ä½œä¸ºäº¤äº’ï¼Œåˆ™ commitlint.config.js ä¸­ `parserPreset` å»ºè®®è®¾ç½®æˆ `conventional-changelog-conventionalcommits` ï¼Œè¿™æ˜¯å› ä¸º commitizen åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ… `semantic-release` æ¥è‡ªåŠ¨ç®¡ç†åŒ…ç‰ˆæœ¬æ—¶ï¼Œé…ç½®çš„è§„åˆ™é¢„è®¾æ˜¯ â€œconventionalcommitsâ€ï¼Œè¯¦è§ `commitizen/cz-cli` çš„ package.json æ–‡ä»¶ï¼ˆæˆªå›¾å¦‚ä¸‹ï¼‰ã€‚

![Description](/images/commitlint_1.png)

### å…¶ä»–ï¼š

#### @commitlint/cz-commitlint

å— cz-conventional-changelog åŒ…ä¸­æäº¤è§„èŒƒçš„å¯å‘ï¼Œæä¾›çš„ä¸€ç§æ›´ç°ä»£çš„äº¤äº’æ–¹å¼ã€‚éœ€è¦å’Œ commitizen æˆ–è€… prompt ç»“åˆä½¿ç”¨ï¼Œä¹Ÿæ˜¯ä¸€ç§é€‚é…å™¨ã€‚

## CLI

```bash
â¯ npx commitlint --help

@commitlint/cli@19.5.0 - Lint your commit messages

[input] reads from stdin if --edit, --env, --from and --to are omitted

Options:
# åˆ‡æ¢æ˜¯å¦ç»™è¾“å‡ºå†…å®¹æ·»åŠ é¢œè‰²ï¼ˆä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ… chalkï¼‰
  -c, --color          toggle colored output           [boolean] [default: true]
# ä½¿ç”¨çš„ commitlint é…ç½®æ–‡ä»¶ï¼ˆcommitlint.config.jsï¼‰çš„è·¯å¾„
  -g, --config         path to the config file; result code 9 if config is
                       missing                                          [string]
# æ‰“å°é…ç½®æ–‡ä»¶åˆ°ç»ˆç«¯
      --print-config   print resolved config
                                          [string] [choices: "", "text", "json"]
# è®¾ç½®å·¥ä½œç›®å½•
  -d, --cwd            directory to execute in
                                         [string] [default: (Working Directory)]
# è¯»å–æœ€è¿‘ä¸€æ¬¡çš„æäº¤ä¿¡æ¯ï¼ˆæŸä¸ªæ˜ç¡®çš„æ–‡ä»¶æˆ–è€… ./.git/COMMIT_EDITMSG æ–‡ä»¶ï¼‰
  -e, --edit           read last commit message from the specified file or
                       fallbacks to ./.git/COMMIT_EDITMSG               [string]
# æ ¹æ®ç»™å®šçš„ç¯å¢ƒå˜é‡æ£€æŸ¥ â“
  -E, --env            check message in the file at path given by environment
                       variable value                                   [string]
# è®¾ç½®å…±äº«é…ç½®åˆ—è¡¨ï¼ˆextendså­—æ®µï¼‰
  -x, --extends        array of shareable configurations to extend       [array]
# è®¾ç½®é”™è¯¯ä¿¡æ¯ä¸­çš„å¸®åŠ©åœ°å€ï¼ˆä¸€èˆ¬å°±æ˜¯commitlintå®˜ç½‘ï¼‰
  -H, --help-url       help url in error message                        [string]
# è®¾ç½® commitlint èŒƒå›´çš„èµ·å§‹æäº¤ï¼Œeditéœ€ä¸ºfalse
  -f, --from           lower end of the commit range to lint; applies if
                       edit=false                                       [string]
      --from-last-tag  uses the last tag as the lower end of the commit range to
                       lint; applies if edit=false and from is not set [boolean]
      --git-log-args   additional git log arguments as space separated string,
                       example '--first-parent --cherry-pick'           [string]
# åªlintä¸Šä¸€æ¬¡çš„æäº¤ï¼Œeditéœ€ä¸ºfalse
  -l, --last           just analyze the last commit; applies if edit=false
                                                                       [boolean]
# æ ¼å¼åŒ–è¾“å‡º
  -o, --format         output format of the results                     [string]
# é…ç½®è§£æå™¨é¢„è®¾ï¼ˆparserPreset å­—æ®µï¼‰
  -p, --parser-preset  configuration preset to use for
                       conventional-commits-parser                      [string]
# æ˜¯å¦æ˜¾ç¤ºæ§åˆ¶å°è¾“å‡ºï¼ˆç®€å•è¾“å‡ºæ¨¡å¼ï¼‰
  -q, --quiet          toggle console output          [boolean] [default: false]
# è®¾ç½® commitlint èŒƒå›´çš„ç»ˆæ­¢æäº¤ï¼Œeditéœ€ä¸ºfalse
  -t, --to             upper end of the commit range to lint; applies if
                       edit=false                                       [string]
# å½“æäº¤ç¬¦åˆè§„èŒƒæ—¶ï¼Œæç¤ºæäº¤æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼ˆé»˜è®¤ä¸æ˜¾ç¤ºä»»ä½•å†…å®¹ï¼‰
  -V, --verbose        enable verbose output for reports without problems
                                                                       [boolean]
# æ˜¯å¦å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼ˆ2 è¡¨ç¤ºè­¦å‘Šï¼Œ3è¡¨ç¤ºé”™è¯¯ï¼‰
  -s, --strict         enable strict mode; result code 2 for warnings, 3 for
                       errors                                          [boolean]
# é€šè¿‡ä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶æ¥é…ç½® commitlint çš„ CLI è¡Œä¸ºï¼ˆè€Œéè§„åˆ™ï¼‰
      --options        path to a JSON file or Common.js module containing CLI
                       options
# æ˜¾ç¤º commitlint ç‰ˆæœ¬
  -v, --version        display version information                     [boolean]
# æ˜¾ç¤ºå¸®åŠ©å†…å®¹
  -h, --help           Show help                                       [boolean]
```

## é…ç½®

ä½¿ç”¨ `commitlint.config.js` æ–‡ä»¶æˆ–åœ¨ `package.json` ä¸­é…ç½® `commitlint` å­—æ®µã€‚

é…ç½®å¯¹è±¡ç¤ºä¾‹ï¼š

```jsx
const Configuration = {
	extends: ["@commitlint/config-convertional"],
	parserPreset: "convertional-changelog-atom,
	formatter: "@commitlint/format",
	rules: {
		"type-enum": [2, "alway", ["foo"]]
	},
	ignores: [(commit) => commit === ""],
	defaultIgnores: true,
	helpUrl: "https://github.com/conventional-changelog/commitlint/#what-is-commitlint",
	prompt: {
		message: {},
		questions: {
			type: {
				description: "please input type:",
			}
		}
	}
}

export default Configuration;
```

### Typescript é…ç½®

ä» `@commitlint/types` å¯¼å…¥ç›¸å…³ç±»å‹å’Œæšä¸¾ã€‚

ç¤ºä¾‹ï¼š

```jsx
import type { UserConfig } from "@commitlint/types";
import { RuleConfigSeverity } from "@commitlint/types";

const Configuration: UserConfig = {
  extends: ["@commitlint/config-conventional"],
  parserPreset: "conventional-changelog-atom",
  formatter: "@commitlint/format",
  rules: {
    "type-enum": [RuleConfigSeverity.Error, "always", ["foo"]], // â“ä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆå†™
  },
};
```

### ä½¿ç”¨å…±äº«é…ç½®è¿›è¡Œæ‰©å±•

æ–¹å¼ï¼š

- åœ¨é…ç½®æ–‡ä»¶çš„ extends å­—æ®µä¸­æ·»åŠ æ•°ç»„é¡¹
- åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ `commitlint --extends [ex1, ex2, ...]` é…ç½®ä¸´æ—¶ä½¿ç”¨çš„æ‰©å±•é¡¹ã€‚

extends å­—æ®µä¸­é…ç½®çš„ç¬¬ä¸‰æ–¹å…±äº«é…ç½®éœ€è¦æå‰å®‰è£…ï¼Œä¹Ÿå¯ä»¥é…ç½®æœ¬åœ°çš„å…±äº«é…ç½®ã€‚

### è§£æå™¨é¢„è®¾ï¼ˆparserPresetï¼‰

ç”¨äºè§£æ commit msg

ç¤ºä¾‹ï¼š

```jsx
export default {
  // ...
  parserPreset: "conventional-changelog-atom",
  // ...
};
```

æ–¹å¼ï¼š

- é…ç½®æ–‡ä»¶çš„ `parserPreset` å­—æ®µé…ç½®
- å‘½ä»¤è¡Œä½¿ç”¨ `-p, --parser-preset`

å¯ä»¥é…ç½®ç¬¬ä¸‰æ–¹åŒ…å’Œæœ¬åœ°æ–‡ä»¶ã€‚

### æ ¼å¼åŒ–ç¨‹åºï¼ˆformatterï¼‰

æ ¼å¼åŒ– commitlint çš„è¾“å‡ºå†…å®¹ã€‚

ç¤ºä¾‹:

```jsx
export default {
  formatter: "@commitlint/format",
};
```

æ–¹å¼ï¼š

- é…ç½®æ–‡ä»¶çš„ `formatter` å­—æ®µ
- å‘½ä»¤è¡Œä½¿ç”¨ `-o, --format`

## è§„åˆ™é…ç½®

åœ¨é…ç½®æ–‡ä»¶çš„ `rules` å¯¹è±¡ä¸­è¿›è¡Œé…ç½®ã€‚æ¯ä¸ªé…ç½®è§„åˆ™ç”±åç§°ï¼ˆå±æ€§ï¼‰å’Œé…ç½®æ•°ç»„ï¼ˆå€¼ï¼‰ç»„æˆã€‚

é…ç½®æ•°ç»„åŒ…å«ï¼š

```
- é”™è¯¯çº§åˆ«ã€‚å–å€¼[0, 2]ã€‚
    - 0 â€”â€” ç¦ç”¨è§„åˆ™
    - 1 â€”â€” è­¦å‘Š
    - 2 â€”â€” é”™è¯¯
- è§„åˆ™é€‚ç”¨ã€‚å–å€¼ï¼š
    - `always` â€”â€” é€‚ç”¨
    - `never` â€”â€” åè½¬è§„åˆ™
- å€¼
```

æ¯ä¸ªè§„åˆ™çš„å€¼å¯ä»¥ä¸ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°è¿”å›ç±»å‹ä¸º `Array` æˆ– `Promise<Array>` ã€‚

ç¤ºä¾‹ï¼š

```js
export default {
  rules: {
    "header-max-length": [0, "always", 72],
  },
};
```

```js
export default {
  rules: {
    "header-max-length": () => [0, "always", 72],
  },
};
```

```js
export default {
  rules: {
    "header-max-length": async () => [0, "always", 72],
  },
};
```

## è§„åˆ™ï¼ˆRulesï¼‰

[https://commitlint.nodejs.cn/reference/rules.html](https://commitlint.nodejs.cn/reference/rules.html)

## ä½¿ç”¨æ’ä»¶ï¼ˆPluginï¼‰

æ’ä»¶ç”¨äºæ‰©å±•ï¼ˆè‡ªå®šä¹‰ï¼‰è§„åˆ™ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„æ’ä»¶ã€‚

## æç¤ºï¼ˆPromptï¼‰

é»˜è®¤ä½¿ç”¨@commitlint/cz-commitlint é…ç½®æç¤ºã€‚

prompt å±æ€§åŒ…å«ä¸‰ä¸ªå­—æ®µï¼šsettingsã€messagesã€questionsï¼Œéœ€è¦åœ¨ commitlint é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œ prompt é…ç½®ã€‚

##### å®˜æ–¹ç¤ºä¾‹

```js
export default {
  parserPreset: 'conventional-changelog-conventionalcommits',
      rules: {
        // ...
      },
      prompt: {
        settings: {},
        messages: {
          skip: ':skip',
          max: 'upper %d chars',
          min: '%d chars at least',
          emptyWarning: 'can not be empty',
          upperLimitWarning: 'over limit',
          lowerLimitWarning: 'below limit'
        },
        questions: {
          type: {
            description: "Select the type of change that you're committing:",
            enum: {
              feat: {
                description: 'A new feature',
                title: 'Features',
                emoji: 'âœ¨',
              },
              fix: {
                description: 'A bug fix',
                title: 'Bug Fixes',
                emoji: 'ğŸ›',
              },
              docs: {
                description: 'Documentation only changes',
                title: 'Documentation',
                emoji: 'ğŸ“š',
              },
              style: {
                description: 'Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)',
                title: 'Styles',
                emoji: 'ğŸ’',
              },
              refactor: {
                description: 'A code change that neither fixes a bug nor adds a feature',
                title: 'Code Refactoring',
                emoji: 'ğŸ“¦',
              },
              perf: {
                description: 'A code change that improves performance',
                title: 'Performance Improvements',
                emoji: 'ğŸš€',
              },
              test: {
                description: 'Adding missing tests or correcting existing tests',
                title: 'Tests',
                emoji: 'ğŸš¨',
              },
              build: {
                description: 'Changes that affect the build system or external dependencies (example scopes: gulp, broccoli, npm)',
                title: 'Builds',
                emoji: 'ğŸ› ',
              },
              ci: {
                description: 'Changes to our CI configuration files and scripts (example scopes: Travis, Circle, BrowserStack, SauceLabs)',
                title: 'Continuous Integrations',
                emoji: 'âš™ï¸',
              },
              chore: {
                description: "Other changes that don't modify src or test files",
                title: 'Chores',
                emoji: 'â™»ï¸',
              },
              revert: {
                description: 'Reverts a previous commit',
                title: 'Reverts',
                emoji: 'ğŸ—‘',
              },
            },
          },
          scope: {
            description:
              'What is the scope of this change (e.g. component or file name)',
          },
          subject: {
            description: 'Write a short, imperative tense description of the change',
          },
          body: {
            description: 'Provide a longer description of the change',
          },
          isBreaking: {
            description: 'Are there any breaking changes?',
          },
          breakingBody: {
            description:
              'A BREAKING CHANGE commit requires a body. Please enter a longer description of the commit itself',
          },
          breaking: {
            description: 'Describe the breaking changes',
          },
          isIssueAffected: {
            description: 'Does this change affect any open issues?',
          },
          issuesBody: {
            description:
              'If issues are closed, the commit requires a body. Please enter a longer description of the commit itself',
          },
          issues: {
            description: 'Add issue references (e.g. "fix #123", "re #123".)',
          },
        },
      }
};
```

å¯ä»¥ä½¿ç”¨ commitizen + cz-git å¯¹äº¤äº’å¼æç¤ºè¿›è¡ŒåŠŸèƒ½å¢å¼ºã€‚ï¼ˆé…ç½®é¡¹æ›´å¤šäº†ï¼Œå…·ä½“é…ç½®è§ cz-git å®˜æ–¹æ–‡æ¡£ï¼‰

## æºç 

ä½¿ç”¨ pnpm åˆ›å»ºå¤šåŒ…é¡¹ç›®ï¼š

[https://pnpm.io/zh/workspaces](https://pnpm.io/zh/workspaces)

ç¤ºä¾‹ï¼š

![Description](/images/commitlint_2.png)

![Description](/images/commitlint_3.png)

### åˆ›å»ºå¤šåŒ…é¡¹ç›®çš„æ–¹å¼ï¼š

- pnpm
- lerna
- turboropoï¼ˆæœ€ä½³å®è·µï¼‰
- nx
- rustï¼ˆä¼ä¸šçº§ï¼‰
- Bazel/Buck/Pants

### æºç åˆ†æï¼š

ä¸»è¦åŠŸèƒ½éƒ½åœ¨ `@commitlint` ç›®å½•ä¸‹ï¼šï¼ˆé€šè¿‡ lerna åˆ›å»ºçš„å¤šåŒ…é¡¹ç›®ï¼‰

**cli** â€”â€” å‘½ä»¤è¡Œå·¥å…·ï¼ˆè„šæ‰‹æ¶ï¼‰

- å‘½ä»¤é…ç½®ï¼ˆç¬¬ä¸‰æ–¹åŒ… yargsï¼‰
- æ ¹æ®å‘½ä»¤è¡Œè¾“å…¥ï¼Œè§£æå‚æ•°ï¼Œå¯¹å‚æ•°åšä¸åŒå¤„ç†ï¼Œå¾—åˆ° flags å¯¹è±¡
- è°ƒç”¨ **`read`** è¯»å–å†å²æäº¤ä¿¡æ¯ï¼ˆcommit msgï¼‰
- è°ƒç”¨ **`load`** ç­‰æ–¹æ³•è¿›è¡Œé…ç½®çš„åˆå¹¶
- è°ƒç”¨ **`lint`** æ–¹æ³•ï¼Œä¼ å…¥ commit messageã€load æ•´åˆçš„ rulesã€æ•´åˆçš„ lint é…ç½®å¯¹è±¡ã€‚è¿™æ­¥å°±æ­£å¼å¯¹ commit message è¿›è¡Œ lintï¼Œæœ€ç»ˆè¿”å› lint çš„ç»“æœ
- å°† lint çš„ç»“æœé€šè¿‡ **`format`** æ ¼å¼åŒ–è¾“å‡ºã€‚

**lint** â€”â€” lint commit message

- é€šè¿‡è°ƒç”¨ **`parse`** è§£æ commit messageï¼Œæˆä¸ºæ ¼å¼ç»Ÿä¸€çš„å¯¹è±¡
- è§„åˆ™è¿‡æ»¤ï¼šé…ç½®é”™è¯¯çš„ã€ä¸èƒ½æ‰§è¡Œçš„ã€ç­‰çº§ä¸º 0 çš„è§„åˆ™ï¼Œå¾—åˆ°çœŸæ­£éœ€è¦ lint çš„è§„åˆ™
- æ ¹æ®ä¼ å…¥çš„é…ç½®å¯¹è±¡ï¼Œå¦‚æœæœ‰é¢å¤–çš„ pluginï¼Œå°† plugin ä¸­çš„è‡ªå®šä¹‰è§„åˆ™åŠ å…¥åˆ°é»˜è®¤çš„ **`rules`**
- æ ¹æ®è¿‡æ»¤åçš„è§„åˆ™é…ç½®è·å–åˆ° **`rules`** ä¸­å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œå°†è§£æåçš„ commit message å¯¹è±¡ä¸€ä¸€ä¼ å…¥å¤„ç†å‡½æ•°æ‰§è¡Œï¼Œè¿”å›æ‰§è¡Œç»“æœã€‚

**parse** â€”â€” è§£æ commit message ä»¥ä¾› lint ä½¿ç”¨ï¼ˆé»˜è®¤ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ… conventional-commits-parser è¿›è¡Œè§£æï¼Œè§£æä¾æ®æ ‡å‡†é»˜è®¤ä½¿ç”¨ conventional-changelog-angularï¼Œä½ ä¹Ÿå¯ä»¥æä¾›å…¶ä»–è¯­æ³•è§£æè§„åˆ™ï¼Œä¾‹å¦‚ï¼šconventional-changelog-conventionalcommitsï¼‰

**load** â€”â€” å¤„ç†é…ç½®å¯¹è±¡

- éªŒè¯é…ç½®æ–‡ä»¶ä¸­è§„åˆ™é…ç½®æ˜¯å¦ç¬¦åˆé…ç½®æ ¼å¼ï¼ˆç¬¬ä¸‰æ–¹åŒ… ajvï¼‰
- åˆå¹¶å‘½ä»¤è¡Œã€package.json ä¸­ `commitlint` å­—æ®µã€ `commitlint.config.js` é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®
- è°ƒç”¨ **`execute-rule`** ï¼Œä¼ å…¥åˆå¹¶åçš„é…ç½®å¯¹è±¡ï¼Œå› ä¸ºé…ç½®è§„åˆ™å¯èƒ½ä¸ºä¸€ä¸ªæ•°ç»„ä¹Ÿå¯èƒ½ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœæ˜¯æ•°ç»„åˆ™å¤„ç†æˆå‡½æ•°ï¼ˆç»Ÿä¸€åŒ–å¤„ç†ï¼Œæ–¹ä¾¿åç»­è¿‡æ»¤åˆ¤æ–­ï¼‰
- æ‰©å±•åŒ…çš„é…ç½®åˆå¹¶å¤„ç†ç­‰ï¼Œæœ€ç»ˆè¿”å›å¤„ç†åçš„é…ç½®å¯¹è±¡ã€‚

**rules** â€”â€” è§„åˆ™é…ç½®å’Œè§„åˆ™æ‰§è¡Œã€‚æ¯ä¸ªè§„åˆ™å¯¹åº”ä¸€ä¸ªæ‰§è¡Œå‡½æ•°ï¼Œç”¨äºåˆ¤æ–­è§£æåçš„ commit message å¯¹è±¡æ˜¯å¦ç¬¦åˆè§„åˆ™ã€‚

**read** â€”â€” è¯»å–æäº¤ä¿¡æ¯ï¼Œæµå¼è¾“å‡º

**format** â€”â€” æ ¼å¼åŒ– lint è¾“å‡ºï¼Œcommitlint é»˜è®¤çš„ formatter

**prompt å’Œ prompt-cli** â€”â€” æä¾›äº¤äº’å¼å‘½ä»¤åŠŸèƒ½

**cz-commitlint** â€”â€” æä¾›çš„ä¸€ç§æ›´ç°ä»£çš„äº¤äº’æ–¹å¼ï¼Œæ˜¯äº¤äº’å¼æç¤ºåŸºåº§çš„é€‚é…å™¨

**core** â€”â€” å¯¼å‡º formatã€loadã€lintã€read æ–¹æ³•ä»¥ä¾›å¤–éƒ¨ä½¿ç”¨

![Description](/images/commitlint_4.png)

ä¾èµ–åŒ…ï¼š

- [yargs](https://yargs.js.org/) â€”â€” é…ç½®å‘½ä»¤è¡Œå¯ç”¨å‘½ä»¤ï¼Œä»¥ä¾¿åç»­å¤„ç†ï¼ˆç±»ä¼¼çš„åŒ…å¦‚ï¼šcommanderï¼‰
- chalk â€”â€” ç»ˆç«¯é¢œè‰²é…ç½®
- tinyexecï¼ˆâ€”> cross-spawn â€”> node:child_processï¼‰ â€”â€” æ‰§è¡Œå‘½ä»¤

### è®¾ç½® commitlint è„šæœ¬æ‰§è¡Œæ–‡ä»¶ï¼š

![Description](/images/commitlint_5.png)

è¯¥æ–‡ä»¶è·¯å¾„æœ€ç»ˆä¼šè®¾ç½®åˆ° `.node_modules/.bin/commitlint` è„šæœ¬æ–‡ä»¶ä¸­ç”¨äºæ‰§è¡Œï¼š

![alt text](/images/commitlint_7.png)

å› æ­¤è¯¥æ–‡ä»¶éœ€è¦é…ç½®è„šæœ¬æ‰§è¡Œç¯å¢ƒï¼š

![Description](/images/commitlint_6.png)

## [çº¦å®šå¼æäº¤è§„èŒƒï¼ˆ1.0.0ï¼‰](https://www.conventionalcommits.org/zh-hans/v1.0.0-beta.4/)

ï¼ˆcommitlint é»˜è®¤ä½¿ç”¨çš„æ˜¯ angular çš„æäº¤è§„èŒƒï¼Œä½†ä¹Ÿæä¾›äº†å¤šç§è§„èŒƒä»¥ä¾›ä½¿ç”¨ï¼‰

### è¯­æ³•

    ```
    **<type>([optional scope]): <description>
    [optional body]
    [optional footer(s)]**
    ```

#### ç±»å‹ï¼ˆtypeï¼‰

    - feat â€”â€” æ–°å¢åŠŸèƒ½**ï¼ˆå¯¹åº” Semver çš„ MINORï¼‰**
    - fix â€”â€” ä¿®å¤ bug **ï¼ˆå¯¹åº” Semver çš„ PATCHï¼‰**
    - docs â€”â€” æ›´æ”¹æ–‡æ¡£
    - style â€”â€” ä¸å½±å“ä»£ç å«ä¹‰çš„å˜åŒ–ï¼ˆå¦‚ç©ºæ ¼ã€æ ¼å¼åŒ–ã€ç¼ºå°‘åˆ†å·ç­‰ï¼‰
    - refactor â€”â€” ä»£ç é‡æ„ï¼Œæ—¢ä¸ä¿®å¤é”™è¯¯ä¹Ÿä¸æ·»åŠ åŠŸèƒ½
    - perf â€”â€” æå‡æ€§èƒ½çš„ä»£ç æ›´æ”¹
    - test â€”â€” æµ‹è¯•ä»£ç æ›´æ”¹
    - build â€”â€” æ„å»ºç³»ç»Ÿæˆ–å¤–éƒ¨ä¾èµ–å…³ç³»çš„æ›´æ”¹
    - ci â€”â€” æŒç»­é›†æˆæ–‡ä»¶å’Œè„šæœ¬çš„æ›´æ”¹
    - chore â€”â€” å…¶ä»–ä¿®æ”¹ï¼ˆä¸ä¿®æ”¹ src æˆ– test æ–‡ä»¶ï¼‰
    - revert â€”â€” commit å›é€€

#### èŒƒå›´ï¼ˆscopeï¼‰

    ä¸ºæäº¤ç±»å‹æ·»åŠ ä¸€ä¸ªä½¿ç”¨åœ†æ‹¬å·åŒ…è£¹çš„ä½œç”¨åŸŸï¼Œä»¥ä¸ºå…¶æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ä¾‹ï¼š `feat(parser): add ability to parse arrays.`

#### BREAKING CHANGEï¼ˆfooterï¼‰

    ç ´åæ€§ API å˜æ›´**ï¼ˆå¯¹åº” Semver çš„ MAJORï¼‰**

### è§„åˆ™

- æ¯ä¸ªæäº¤éƒ½å¿…é¡»ä½¿ç”¨ç±»å‹ï¼ˆtypeï¼‰å­—æ®µå‰ç¼€ï¼Œå…¶åæ¥ä¸€ä¸ªå¯é€‰çš„ä½œç”¨åŸŸå­—æ®µï¼Œä»¥åŠä¸€ä¸ªå¿…è¦çš„å†’å·ï¼ˆè‹±æ–‡åŠè§’ï¼‰å’Œç©ºæ ¼ã€‚
- å½“ä¸€ä¸ªæäº¤ä¸ºåº”ç”¨æˆ–ç±»åº“å®ç°äº†æ–°ç‰¹æ€§æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ `feat` ç±»å‹ã€‚
- å½“ä¸€ä¸ªæäº¤ä¸ºåº”ç”¨ä¿®å¤äº† bug æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ `fix` ç±»å‹ã€‚
- ä½œç”¨åŸŸå¿…é¡»æ˜¯ä¸€ä¸ªæè¿°æŸéƒ¨åˆ†ä»£ç çš„åè¯ï¼Œå¹¶ç”¨åœ†æ‹¬å·åŒ…å›´ã€‚ä¾‹å¦‚ `fix(parser):`
- æè¿°å­—æ®µï¼ˆdescriptionï¼‰å¿…é¡»ç´§è·Ÿåœ¨ç±»å‹/ä½œç”¨åŸŸå‰ç¼€çš„ç©ºæ ¼ä¹‹åã€‚æ˜¯å¯¹ä»£ç å˜æ›´çš„ç®€çŸ­æ€»ç»“ã€‚
- åœ¨ç®€çŸ­æè¿°ä¹‹åï¼Œå¯ä»¥ç¼–å†™æ›´é•¿çš„æäº¤æ­£æ–‡ï¼ˆbodyï¼‰ï¼Œä¸ºä»£ç å˜æ›´ææ›´é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚æ­£æ–‡å¿…é¡»èµ·å§‹äºæè¿°å­—æ®µç»“æŸçš„ä¸€ä¸ªç©ºè¡Œåã€‚
- åœ¨æ­£æ–‡ç»“æŸçš„ä¸€ä¸ªç©ºè¡Œä¹‹åï¼Œå¯ä»¥ç¼–å†™ä¸€è¡Œæˆ–å¤šè¡Œè„šæ³¨ï¼ˆfooterï¼‰ã€‚è„šæ³¨å¿…é¡»åŒ…å«å…³äºæäº¤çš„å…ƒä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šå…³è”çš„åˆå¹¶è¯·æ±‚ã€Reviewerã€ç ´åæ€§å˜æ›´ï¼ˆBREAKING CHANGEï¼‰ï¼Œæ¯æ¡å…ƒä¿¡æ¯å æ®ä¸€è¡Œã€‚
- ç ´åæ€§å˜æ›´å¿…é¡»æ ‡ç¤ºåœ¨æ­£æ–‡åŒºåŸŸæœ€å¼€å§‹å¤„ï¼Œæˆ–è€…è„šæ³¨åŒºåŸŸä¸­æŸä¸€è¡Œçš„å¼€å§‹ã€‚ä¸€ä¸ªç ´åæ€§å˜æ›´å¿…é¡»åŒ…å«å¤§å†™çš„æ–‡æœ¬ `BREAKING CHANGE` ï¼Œåé¢ç´§è·Ÿå†’å·å’Œç©ºæ ¼ã€‚å…¶åå¿…é¡»æä¾›å¯¹ API å˜æ›´çš„æè¿°ã€‚
- **å¯ä»¥åœ¨ç±»å‹/ä½œç”¨åŸŸå‰ç¼€ä¹‹åï¼Œ `:` ä¹‹å‰ï¼Œæ·»åŠ  `!` ï¼Œä»¥è¿›ä¸€æ­¥æé†’æ³¨æ„ç ´åæ€§å˜æ›´ã€‚å½“æœ‰ `!` å‰ç¼€æ—¶ï¼Œæ­£æ–‡æˆ–è„šæ³¨å†…å¿…é¡»åŒ…å« `BREAKING CHANGE: description`**

### ç¤ºä¾‹

```
1.åŒ…å«äº†æè¿°ä»¥åŠæ­£æ–‡å†…æœ‰ç ´åæ€§å˜æ›´çš„æäº¤è¯´æ˜ï¼š
feat: allow provided config object to extend other configs

BREAKING CHANGE: `extends` key in config file is now used for extending other config files

2.åŒ…å«äº†å¯é€‰çš„ ! å­—ç¬¦ä»¥æé†’æ³¨æ„ç ´åæ€§å˜æ›´çš„æäº¤è¯´æ˜ï¼š
chore!: drop Node 6 from testing matrix

BREAKDING CHANGE: dropping Node 6 which hits end of life in April

3.ä¸åŒ…å«æ­£æ–‡çš„æäº¤è¯´æ˜
docs: correct spelling of CHANGELOG

4.åŒ…å«ä½œç”¨åŸŸçš„æäº¤è¯´æ˜
feat(lang): add polish language

5.ä¸º fix ç¼–å†™çš„æäº¤è¯´æ˜ï¼ŒåŒ…å«ï¼ˆå¯é€‰çš„ï¼‰issue ç¼–å·
fix: correct minor typos in code

see the issue for details on the typos fixed

close issue #12
```

### **ä¸ºä»€ä¹ˆä½¿ç”¨çº¦å®šå¼æäº¤**

- è‡ªåŠ¨åŒ–ç”Ÿæˆæ›´æ–°æ—¥å¿—ï¼ˆCHANGELOGï¼Œå°±æ˜¯çº¦å®šå¼æäº¤çš„æ ¼å¼å†…å®¹ï¼‰
- **åŸºäºæäº¤çš„ç±»å‹ï¼Œè‡ªåŠ¨å†³å®šè¯­ä¹‰åŒ–ç‰ˆæœ¬çš„å˜æ›´ã€‚**
- è§¦å‘æ„å»ºå’Œéƒ¨ç½²æµç¨‹ã€‚

### å…¶ä»–

ï¼ˆ1ï¼‰[Semver](https://semver.org/lang/zh-CN/)

ï¼ˆ2ï¼‰[Angular çº¦å®šå¼æäº¤è§„èŒƒ](https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit?tab=t.0#heading=h.greljkmo14y0)ï¼ˆåŸºæœ¬ä¸Šè§„èŒƒéƒ½æ˜¯ä¾ç…§è¿™ä¸ªæ¥çš„ï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹ï¼‰

[angular/commit-message-guidelines](https://github.com/angular/angular/blob/22b96b9/CONTRIBUTING.md#-commit-message-guidelines)

ï¼ˆ3ï¼‰[conventional-changelog](https://github.com/conventional-changelog) è¿™æ˜¯ä¸€ä¸ªå¤šåŒ…é¡¹ç›®ï¼Œé‡Œé¢æœ‰å¤šç§é…ç½®å¥½çš„è§„èŒƒï¼Œæ˜¯ä¸€ä¸ª CLI å·¥å…·ã€‚

[conventional-changelog-conventionalcommints](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-conventionalcommits)
conventional-changelog æä¾›çš„å…¶ä¸­ä¸€ä¸ª commit è¯­æ³•è§£æè§„åˆ™ã€‚

**å®‰è£…**

```bash
npm i -D conventional-changelog-conventionalcommits
```

**é—´æ¥ä½¿ç”¨**

å¦‚æœå®‰è£…äº†æ•´ä¸ª `conventional-changelog` åŒ…ï¼Œåˆ™å¯ä»¥é€šè¿‡ `changelog -p` CLI ä½¿ç”¨æŸä¸ªè§„èŒƒåŒ…ã€‚

**ç›´æ¥ä½¿ç”¨**

[conventional-changelog-parser](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-commits-parser) å¯¹ commit message è¿›è¡Œè§£æå¤„ç†ï¼Œå°† changelog è½¬æ¢ä¸ºå¯¹è±¡ã€‚ï¼ˆcommitlint ä½¿ç”¨è¯¥åŒ…å®ç° parseï¼‰

**é€šå¸¸é€šè¿‡äº¤äº’å¼å‘½ä»¤å¯ä»¥å¾—åˆ°ä¸€ä¸ª commit message å­—ç¬¦ä¸²ï¼Œå¦‚æœè¦å¯¹ commit message è¿›è¡Œæ ¡éªŒï¼ˆlintï¼‰ï¼Œéœ€è¦å°†å­—ç¬¦ä¸²è¿›è¡Œè½¬æ¢ã€‚**

ç¤ºä¾‹ï¼š

```
'feat(scope): broadcast $destroy event on scope destruction
Closes #1'
```

è½¬æ¢åï¼š

```js
{
  type: 'feat',
  scope: 'scope',
  subject: 'broadcast $destroy event on scope destruction',
  merge: null,
  header: 'feat(scope): broadcast $destroy event on scope destruction',
  body: null,
  footer: 'Closes #1',
  notes: [],
  references: [{
    action: 'Closes',
    owner: null,
    repository: null,
    issue: '1',
    raw: '#1',
    prefix: '#'
  }],
  mentions: [],
  revert: null
}
```
